{"version":3,"sources":["../../../src/frontend/js/client.js"],"names":["connectedUser","room","peerConns","stream","signalingSocket","iceServers","BROADCASTMESSAGE","ENTER_ROOM","LEAVE_ROOM","NEGOTIATION_MESSAGE","OFFER","ANSWER","CANDIDATE","SUCESS_NEGOTIATION","FAILED_NEGOTIATION","ROOM_MESSANGE","FAILED_ENTER_ROOM","SESSION_MESSAGE","LOGIN","LOGOUT","ERR_MESSAGE","INVALIDMESSAGE","INVALIDUSER","SERVER_ERR","SignalingSocket","prototype","init","wsURL","callback","websocket","WebSocket","e","console","log","onopen","onmessage","msg","data","JSON","parse","type","handleLogin","success","handleLogout","handleAuthenticate","handleEnterRoom","handleLeaveRoom","handleOffer","fromUserID","sdp","handleAnswer","handleCandidate","candidate","handleBroadcastLeaveRoom","userID","onerror","err","send","message","name","stringify","exception","userIDInput","document","querySelector","roomPage","roomIDInput","enterRoomBtn","callPage","inviteoUserIDInput","inviteBtn","displayRoomID","leaveRoomBtn","videoArea","localVideo","style","display","getChannelinfo","roomID","httpRequest","XMLHttpRequest","Error","url","window","location","protocol","open","onreadystatechange","readyState","DONE","status","response","responseText","parsingResponseData","addEventListener","value","innerHTML","channelInfo","toString","users","serverinfo","stunServer","turnServer","signalServer","length","inviteUserID","inviteUserIDInput","toUserID","alert","switchToCallpage","navigator","webkitGetUserMedia","video","audio","myStream","srcObject","error","forEach","user","i","createRemoteVideo","remoteVideo","initRtcPeerClient","client","conn","peerConnection","createOffer","offer","setLocalDescription","setRemoteDescription","RTCSessionDescription","createAnswer","answer","addIceCandidate","RTCIceCandidate","getTracks","track","stop","close","onicecandidate","onaddstream","pause","deleteRemoteleteRemoteVideo","switchToRoomPage","dom","source","createElement","autoplay","appendChild","parentElement","removeChild"],"mappings":"aAAA,IAAIA,aAAJ;AACA,IAAIC,IAAJ;;AAEA,IAAIC,SAAS,GAAC,EAAd;AACA,IAAIC,MAAJ;AACA,IAAIC,eAAJ;AACA,IAAIC,UAAU,GAAC,EAAf;;AAEA,IAAMC,gBAAgB,GAAE;AAClBC,EAAAA,UAAU,EAAC,qBADO;AAElBC,EAAAA,UAAU,EAAC,qBAFO,EAAxB;;;AAKA,IAAMC,mBAAmB,GAAE;AACrBC,EAAAA,KAAK,EAAC,mBADe;AAErBC,EAAAA,MAAM,EAAC,oBAFc;AAGrBC,EAAAA,SAAS,EAAC,uBAHW;AAIrBC,EAAAA,kBAAkB,EAAC,oBAJE;AAKrBC,EAAAA,kBAAkB,EAAC,oBALE,EAA3B;;;AAQA,IAAMC,aAAa,GAAE;AACfR,EAAAA,UAAU,EAAC,gBADI;AAEfS,EAAAA,iBAAiB,EAAC,sBAFH;AAGfR,EAAAA,UAAU,EAAC,gBAHI,EAArB;;;AAMA,IAAMS,eAAe,GAAE;AACjBC,EAAAA,KAAK,EAAE,eADU;AAEjBC,EAAAA,MAAM,EAAE,gBAFS,EAAvB;;;AAKA,IAAMC,WAAW,GAAE;AACbC,EAAAA,cAAc,EAAE,oBADH;AAEbC,EAAAA,WAAW,EAAE,iBAFA;AAGbC,EAAAA,UAAU,EAAC,iBAHE,EAAnB;;;AAMA,SAASC,eAAT,GAA0B;;AAEzB;;AAEDA,eAAe,CAACC,SAAhB,CAA0BC,IAA1B,GAAgC,UAASC,KAAT,EAAeC,QAAf,EAAwB;AAClD,MAAG;AACG,SAAKC,SAAL,GAAiB,IAAIC,SAAJ,CAAcH,KAAd,CAAjB;AACL,GAFD,CAEC,OAAMI,CAAN,EAAQ;AACHC,IAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AACL;;AAED,OAAKF,SAAL,CAAeK,MAAf,GAAwB,YAAY;AAC9BF,IAAAA,OAAO,CAACC,GAAR,CAAY,mCAAZ;AACAL,IAAAA,QAAQ;AACb,GAHD;;;AAMA,OAAKC,SAAL,CAAeM,SAAf,GAA2B,UAAUC,GAAV,EAAe;AACpCJ,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BG,GAAG,CAACC,IAA/B;;AAEA,QAAIA,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWH,GAAG,CAACC,IAAf,CAAX;;AAEA,YAAOA,IAAI,CAACG,IAAZ;;AAEM,WAAKvB,eAAe,CAACC,KAArB;AACMuB,QAAAA,WAAW,CAACJ,IAAI,CAACK,OAAN,CAAX;AACN;;AAEA,WAAKzB,eAAe,CAACE,MAArB;AACMwB,QAAAA,YAAY;AAClB;;AAEA,WAAK,cAAL;AACMC,QAAAA,kBAAkB,CAACP,IAAI,CAACK,OAAN,CAAlB;AACN;;AAEA,WAAK3B,aAAa,CAACR,UAAnB;AACMsC,QAAAA,eAAe;AACrB;;AAEA,WAAK9B,aAAa,CAACP,UAAnB;AACMsC,QAAAA,eAAe;AACrB;;AAEA,WAAKrC,mBAAmB,CAACC,KAAzB;AACMqC,QAAAA,WAAW,CAAEV,IAAI,CAACW,UAAP,EAAkBX,IAAI,CAACY,GAAvB,CAAX;AACN;;AAEA,WAAKxC,mBAAmB,CAACE,MAAzB;AACMuC,QAAAA,YAAY,CAACb,IAAI,CAACW,UAAN,EAAiBX,IAAI,CAACY,GAAtB,CAAZ;AACN;;AAEA,WAAKxC,mBAAmB,CAACG,SAAzB;AACMuC,QAAAA,eAAe,CAACd,IAAI,CAACW,UAAN,EAAiBX,IAAI,CAACe,SAAtB,CAAf;AACN;;AAEA,WAAK9C,gBAAgB,CAACE,UAAtB;AACM6C,QAAAA,wBAAwB,CAAChB,IAAI,CAACiB,MAAN,CAAxB;AACN;;AAEA;;AAEA,cAxCN;;AA0CL,GA/CD;;AAiDA,OAAKzB,SAAL,CAAe0B,OAAf,GAAyB,UAAUC,GAAV,EAAe;AAClCxB,IAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBuB,GAAzB;AACL,GAFD;;AAIL,CAlED;;AAoEAhC,eAAe,CAACC,SAAhB,CAA0BgC,IAA1B,GAAiC,UAAUC,OAAV,EAAmB;AAC9C,MAAI1D,aAAa,CAAC2D,IAAlB,EAAwB;AAClBD,IAAAA,OAAO,CAACV,UAAR,GAAqBhD,aAAa,CAAC2D,IAAnC;AACL;;AAED3B,EAAAA,OAAO,CAACC,GAAR,CAAY,iBAAgBK,IAAI,CAACsB,SAAL,CAAeF,OAAf,CAA5B;;AAEA,MAAG;AACG,SAAK7B,SAAL,CAAe4B,IAAf,CAAoBnB,IAAI,CAACsB,SAAL,CAAeF,OAAf,CAApB;AACL,GAFD,CAEC,OAAMG,SAAN,EAAgB;;AAEX7B,IAAAA,OAAO,CAACC,GAAR,CAAY,gCAAZ,EAA6C4B,SAA7C;;AAEL;;AAEN,CAfD;;AAiBA,IAAIC,WAAW,GAAGC,QAAQ,CAACC,aAAT,CAAuB,cAAvB,CAAlB;;AAEA,IAAIC,QAAQ,GAAGF,QAAQ,CAACC,aAAT,CAAuB,WAAvB,CAAf;AACA,IAAIE,WAAW,GAAGH,QAAQ,CAACC,aAAT,CAAuB,cAAvB,CAAlB;AACA,IAAIG,YAAY,GAAGJ,QAAQ,CAACC,aAAT,CAAuB,eAAvB,CAAnB;;AAEA,IAAII,QAAQ,GAAGL,QAAQ,CAACC,aAAT,CAAuB,WAAvB,CAAf;AACA,IAAIK,kBAAkB,GAAGN,QAAQ,CAACC,aAAT,CAAuB,oBAAvB,CAAzB;AACA,IAAIM,SAAS,GAAGP,QAAQ,CAACC,aAAT,CAAuB,YAAvB,CAAhB;AACA,IAAIO,aAAa,GAAER,QAAQ,CAACC,aAAT,CAAuB,gBAAvB,CAAnB;;AAEA,IAAIQ,YAAY,GAAGT,QAAQ,CAACC,aAAT,CAAuB,eAAvB,CAAnB;;AAEA,IAAIS,SAAS,GAAGV,QAAQ,CAACC,aAAT,CAAuB,YAAvB,CAAhB;AACA,IAAIU,UAAU,GAAGX,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAjB;;;AAGAI,QAAQ,CAACO,KAAT,CAAeC,OAAf,GAAyB,MAAzB;;AAEA,SAASC,cAAT,CAAwBvB,MAAxB,EAA+BwB,MAA/B,EAAsClD,QAAtC,EAAgD;AAC1C,MAAImD,WAAW,GAAG,IAAIC,cAAJ,EAAlB;;AAEA,MAAG,CAACD,WAAJ,EAAiB;AACX/C,IAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;AACAL,IAAAA,QAAQ,CAAC,IAAIqD,KAAJ,CAAU,4BAAV,CAAD,CAAR;AACL;;AAED,MAAIC,GAAJ;;AAEA,MAAGC,MAAM,CAACC,QAAP,CAAgBC,QAAhB,IAA2B,QAA9B,EAAuC;AACjCH,IAAAA,GAAG,GAAE,8CAA4CJ,MAA5C,GAAmD,QAAnD,GAA4DxB,MAAjE,CADiC,CACuC;AAC7E,GAFD,MAEK;AACC4B,IAAAA,GAAG,GAAE,gCAA8BJ,MAA9B,GAAqC,QAArC,GAA8CxB,MAAnD,CADD,CAC2D;AAC/D;;AAEDyB,EAAAA,WAAW,CAACO,IAAZ,CAAiB,KAAjB,EAAuBJ,GAAvB,EAA4B,IAA5B;;AAEAH,EAAAA,WAAW,CAACQ,kBAAZ,GAAiC,YAAW;AACtC,QAAIR,WAAW,CAACS,UAAZ,KAA2BR,cAAc,CAACS,IAA9C,EAAoD;AAC9C,UAAIV,WAAW,CAACW,MAAZ,KAAuB,GAA3B,EAAgC;;AAE1B,YAAIC,QAAQ,GAAGZ,WAAW,CAACa,YAA3B;AACA5D,QAAAA,OAAO,CAACC,GAAR,CAAY0D,QAAZ;;AAEA/D,QAAAA,QAAQ,CAAC,IAAD,EAAOiE,mBAAmB,CAACF,QAAD,CAA1B,CAAR;;AAEL,OAPD,MAOO;;AAED3D,QAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AACAL,QAAAA,QAAQ,CAAC,IAAIqD,KAAJ,CAAU,mBAAV,CAAD,CAAR;;AAEL;AACN;AACN,GAhBD;;AAkBA,WAASY,mBAAT,CAA6BD,YAA7B,EAA0C;;AAEpC,WAAOtD,IAAI,CAACC,KAAL,CAAWqD,YAAX,CAAP;AACL;;AAEDb,EAAAA,WAAW,CAACtB,IAAZ,CAAiB,IAAjB;;AAEL;;;AAGDU,YAAY,CAAC2B,gBAAb,CAA8B,OAA9B,EAAsC,YAAU;;AAE1C9F,EAAAA,aAAa,GAAC;AACR2D,IAAAA,IAAI,EAAEG,WAAW,CAACiC,KADV,EAAd;;;AAIA,MAAIjB,MAAM,GAAGZ,WAAW,CAAC6B,KAAzB;;AAEA9F,EAAAA,IAAI,GAAG,EAAC6E,MAAM,EAACA,MAAR,EAAP;;AAEAP,EAAAA,aAAa,CAACyB,SAAd,GAAyBlB,MAAzB;;AAEAD,EAAAA,cAAc,CAACf,WAAW,CAACiC,KAAb,EAAmB7B,WAAW,CAAC6B,KAA/B,EAAqC,UAASvC,GAAT,EAAayC,WAAb,EAAyB;;AAEtE,QAAGzC,GAAH,EAAO;AACDxB,MAAAA,OAAO,CAACC,GAAR,CAAYuB,GAAG,CAAC0C,QAAJ,EAAZ;;AAEL,KAHD,MAGK;AACC,UAAGD,WAAW,CAAChG,IAAZ,CAAiBkG,KAApB,EAA0B;;AAEpBlG,QAAAA,IAAI,CAACkG,KAAL,GAAYF,WAAW,CAAChG,IAAZ,CAAiBkG,KAA7B;;AAEL,OAJD,MAIK;AACClG,QAAAA,IAAI,CAACkG,KAAL,GAAY,EAAZ;AACL;;AAED,UAAGF,WAAW,CAACG,UAAZ,CAAuBC,UAA1B,EAAqC;AAC/BhG,QAAAA,UAAU,CAACgG,UAAX,GAAuBJ,WAAW,CAACG,UAAZ,CAAuBC,UAA9C;AACL;;AAED,UAAGJ,WAAW,CAACG,UAAZ,CAAuBE,UAA1B,EAAqC;AAC/BjG,QAAAA,UAAU,CAACiG,UAAX,GAAuBL,WAAW,CAACG,UAAZ,CAAuBE,UAA9C;AACL;;AAEDlG,MAAAA,eAAe,GAAG,IAAIoB,eAAJ,EAAlB;;AAEApB,MAAAA,eAAe,CAACsB,IAAhB,CAAqBuE,WAAW,CAACG,UAAZ,CAAuBG,YAAvB,CAAoCrB,GAAzD,EAA6D,YAAU;AACjE,YAAIlF,aAAa,CAAC2D,IAAd,CAAmB6C,MAAnB,GAA4B,CAAhC,EAAmC;AAC7BpG,UAAAA,eAAe,CAACqD,IAAhB,CAAqB;AACfjB,YAAAA,IAAI,EAAEvB,eAAe,CAACC,KADP,EAArB;;AAGL;AACN,OAND;;;;AAUL;;AAEN,GApCa,CAAd;;AAsCL,CAlDD;;;AAqDAoD,SAAS,CAACwB,gBAAV,CAA2B,OAA3B,EAAoC,YAAY;AAC1C,MAAIW,YAAY,GAAGC,iBAAiB,CAACX,KAArC;;AAEA,MAAIU,YAAY,CAACD,MAAb,GAAsB,CAA1B,EAA6B;;AAEvBpG,IAAAA,eAAe,CAACqD,IAAhB,CAAqB;AACfjB,MAAAA,IAAI,EAAE,QADS;AAEfmE,MAAAA,QAAQ,EAAEF,YAFK;AAGf3B,MAAAA,MAAM,EAAE7E,IAAI,CAAC6E,MAHE,EAArB;;AAKL;AACN,CAXD;;AAaAN,YAAY,CAACsB,gBAAb,CAA8B,OAA9B,EAAuC,YAAY;;AAE7C1F,EAAAA,eAAe,CAACqD,IAAhB,CAAqB;AAClBjB,IAAAA,IAAI,EAAEzB,aAAa,CAACP,UADF;AAElBsE,IAAAA,MAAM,EAAE7E,IAAI,CAAC6E,MAFK,EAArB;;;AAKL,CAPD;;AASA,SAASrC,WAAT,CAAqBC,OAArB,EAA8B;AACxB,MAAIA,OAAO,KAAK,KAAhB,EAAuB;;AAEjB1C,IAAAA,aAAa,GAAE,IAAf;AACA4G,IAAAA,KAAK,CAAC,gCAAD,CAAL;;AAEL,GALD,MAKO;;AAED,QAAI3G,IAAI,CAAC6E,MAAL,CAAY0B,MAAZ,GAAqB,CAAzB,EAA4B;AACtBpG,MAAAA,eAAe,CAACqD,IAAhB,CAAqB;AACfjB,QAAAA,IAAI,EAAEzB,aAAa,CAACR,UADL;AAEfuE,QAAAA,MAAM,EAAE7E,IAAI,CAAC6E,MAFE,EAArB;;AAIL;AACN;AACN;;AAED,SAASlC,kBAAT,CAA4BF,OAA5B,EAAoC;;AAE9B,MAAG,CAACA,OAAJ,EAAY;AACNkE,IAAAA,KAAK,CAAC,8BAAD,CAAL;AACL;;AAEN;;AAED,SAAS/D,eAAT,GAA0B;AACpB,MAAIsD,KAAK,GAAElG,IAAI,CAACkG,KAAhB;;AAEAU,EAAAA,gBAAgB;;AAEhB,MAAGV,KAAK,CAACK,MAAN,IAAc,CAAjB,EAAmB;;AAEbM,IAAAA,SAAS,CAACC,kBAAV,CAA6B,EAAEC,KAAK,EAAE,IAAT,EAAeC,KAAK,EAAE,IAAtB,EAA7B,EAA2D,UAAUC,QAAV,EAAoB;AACzE/G,MAAAA,MAAM,GAAG+G,QAAT;AACAxC,MAAAA,UAAU,CAACyC,SAAX,GAAuBhH,MAAvB;;AAEL,KAJD,EAIG,UAAUiH,KAAV,EAAiB;AACdpF,MAAAA,OAAO,CAACC,GAAR,CAAYmF,KAAZ;;AAEL,KAPD;;AASL,GAXD,MAWK;;AAECN,IAAAA,SAAS,CAACC,kBAAV,CAA6B,EAAEC,KAAK,EAAE,IAAT,EAAeC,KAAK,EAAE,IAAtB,EAA7B,EAA2D,UAAUC,QAAV,EAAoB;AACzE/G,MAAAA,MAAM,GAAG+G,QAAT;;AAEAxC,MAAAA,UAAU,CAACyC,SAAX,GAAuBhH,MAAvB;AACAgG,MAAAA,KAAK,CAACkB,OAAN,CAAc,UAACC,IAAD,EAAMC,CAAN,EAAU;;AAElB,YAAIjE,MAAM,GAAGgE,IAAb;;AAEAE,QAAAA,iBAAiB,CAAC/C,SAAD,EAAW,IAAX,EAAgB,UAACjB,GAAD,EAAKiE,WAAL,EAAmB;AAC9C,cAAGjE,GAAH,EAAO;AACPxB,YAAAA,OAAO,CAACC,GAAR,CAAYuB,GAAZ;AACC;;AAED,cAAGiE,WAAH,EAAe;;AAETC,YAAAA,iBAAiB,CAACrH,UAAD,EAAYiD,MAAZ,EAAmBmE,WAAnB,EAA+B,UAACjE,GAAD,EAAKmE,MAAL,EAAc;;AAExDzH,cAAAA,SAAS,CAACoD,MAAD,CAAT,GAAkBqE,MAAlB;;AAEA,kBAAIC,IAAI,GAAGD,MAAM,CAACE,cAAlB;;AAEAD,cAAAA,IAAI,CAACE,WAAL,CAAiB,UAAUC,KAAV,EAAiB;;AAE5B3H,gBAAAA,eAAe,CAACqD,IAAhB,CAAqB;AACfjB,kBAAAA,IAAI,EAAE/B,mBAAmB,CAACC,KADX;AAEfuC,kBAAAA,GAAG,EAAE8E,KAFU;AAGfpB,kBAAAA,QAAQ,EAACrD,MAHM,EAArB;;;AAMAsE,gBAAAA,IAAI,CAACI,mBAAL,CAAyBD,KAAzB;;AAEL,eAVD,EAUG,UAAUX,KAAV,EAAiB;AACdR,gBAAAA,KAAK,CAAC,8BAAD,CAAL;AACL,eAZD;;AAcL,aApBgB,CAAjB;;AAsBL,WAxBD,MAwBK;AACL5E,YAAAA,OAAO,CAACC,GAAR,CAAY,6BAAZ;AACC;;AAEN,SAjCgB,CAAjB;;AAmCL,OAvCD;;;AA0CL,KA9CD,EA8CG,UAAUmF,KAAV,EAAiB;;AAEdpF,MAAAA,OAAO,CAACC,GAAR,CAAYmF,KAAZ;;AAEL,KAlDD;;AAoDL;AACN;;AAED,SAASrE,WAAT,CAAqBO,MAArB,EAA4ByE,KAA5B,EAAmC;;AAE7BP,EAAAA,iBAAiB,CAAC/C,SAAD,EAAW,IAAX,EAAgB,UAACjB,GAAD,EAAKiE,WAAL,EAAmB;AAC9C,QAAGjE,GAAH,EAAO;AACDxB,MAAAA,OAAO,CAACC,GAAR,CAAYuB,GAAZ;AACL;;AAED,QAAGiE,WAAH,EAAe;;AAETC,MAAAA,iBAAiB,CAACrH,UAAD,EAAYiD,MAAZ,EAAmBmE,WAAnB,EAA+B,UAACjE,GAAD,EAAKmE,MAAL,EAAc;;AAExDzH,QAAAA,SAAS,CAACoD,MAAD,CAAT,GAAkBqE,MAAlB;;AAEA,YAAIC,IAAI,GAAED,MAAM,CAACE,cAAjB;;AAEAD,QAAAA,IAAI,CAACK,oBAAL,CAA0B,IAAIC,qBAAJ,CAA0BH,KAA1B,CAA1B;;AAEAH,QAAAA,IAAI,CAACO,YAAL,CAAkB,UAAUC,MAAV,EAAkB;AAC9BR,UAAAA,IAAI,CAACI,mBAAL,CAAyBI,MAAzB;;AAEAhI,UAAAA,eAAe,CAACqD,IAAhB,CAAqB;AACrBjB,YAAAA,IAAI,EAAE/B,mBAAmB,CAACE,MADL;AAErBsC,YAAAA,GAAG,EAAEmF,MAFgB;AAGrBzB,YAAAA,QAAQ,EAAErD,MAHW,EAArB;;;AAML,SATD,EASG,UAAU8D,KAAV,EAAiB;AACdR,UAAAA,KAAK,CAAC,+BAAD,CAAL;AACL,SAXD;;AAaL,OArBgB,CAAjB;;AAuBL,KAzBD,MAyBK;AACC5E,MAAAA,OAAO,CAACC,GAAR,CAAY,6BAAZ;AACL;;AAEN,GAlCgB,CAAjB;;AAoCL;;AAED,SAASiB,YAAT,CAAsBI,MAAtB,EAA6B8E,MAA7B,EAAqC;AAC/BlI,EAAAA,SAAS,CAACoD,MAAD,CAAT,CAAkBuE,cAAlB,CAAiCI,oBAAjC,CAAsD,IAAIC,qBAAJ,CAA0BE,MAA1B,CAAtD;AACL;;AAED,SAASjF,eAAT,CAAyBG,MAAzB,EAAgCF,SAAhC,EAA2C;AACrClD,EAAAA,SAAS,CAACoD,MAAD,CAAT,CAAkBuE,cAAlB,CAAiCQ,eAAjC,CAAiD,IAAIC,eAAJ,CAAoBlF,SAApB,CAAjD;AACL;;AAED,SAASN,eAAT,GAA0B;;AAEpB7C,EAAAA,IAAI,GAAG,IAAP;;AAEAE,EAAAA,MAAM,CAACoI,SAAP,GAAmBlB,OAAnB,CAA2B,UAACmB,KAAD,EAAOjB,CAAP,EAAW;AAChCiB,IAAAA,KAAK,CAACC,IAAN;AACL,GAFD;;AAIA,OAAKnF,MAAL,IAAepD,SAAf,EAAyB;;AAEnBA,IAAAA,SAAS,CAACoD,MAAD,CAAT,CAAkBuE,cAAlB,CAAiCa,KAAjC;AACAxI,IAAAA,SAAS,CAACoD,MAAD,CAAT,CAAkBuE,cAAlB,CAAiCc,cAAjC,GAAkD,IAAlD;AACAzI,IAAAA,SAAS,CAACoD,MAAD,CAAT,CAAkBuE,cAAlB,CAAiCe,WAAjC,GAA+C,IAA/C;;AAEA1I,IAAAA,SAAS,CAACoD,MAAD,CAAT,CAAkBmE,WAAlB,CAA8BoB,KAA9B;AACAC,IAAAA,2BAA2B,CAAC5I,SAAS,CAACoD,MAAD,CAAT,CAAkBmE,WAAnB,CAA3B;AACAvH,IAAAA,SAAS,CAACoD,MAAD,CAAT,CAAkBmE,WAAlB,GAA8B,IAA9B;;AAEL;;AAEDrH,EAAAA,eAAe,CAACqD,IAAhB;AACM;AACMjB,IAAAA,IAAI,EAACvB,eAAe,CAACE,MAD3B,EADN;;;;;AAOL;;AAED,SAASkC,wBAAT,CAAkCC,MAAlC,EAAyC;;AAEnCtB,EAAAA,OAAO,CAACC,GAAR,CAAYqB,MAAM,GAAE,OAApB;;AAEA,MAAGpD,SAAS,CAACoD,MAAD,CAAZ,EAAqB;;AAEfpD,IAAAA,SAAS,CAACoD,MAAD,CAAT,CAAkBuE,cAAlB,CAAiCa,KAAjC;AACAxI,IAAAA,SAAS,CAACoD,MAAD,CAAT,CAAkBuE,cAAlB,CAAiCc,cAAjC,GAAkD,IAAlD;AACAzI,IAAAA,SAAS,CAACoD,MAAD,CAAT,CAAkBuE,cAAlB,CAAiCe,WAAjC,GAA+C,IAA/C;;AAEA1I,IAAAA,SAAS,CAACoD,MAAD,CAAT,CAAkBmE,WAAlB,CAA8BoB,KAA9B;AACAC,IAAAA,2BAA2B,CAAC5I,SAAS,CAACoD,MAAD,CAAT,CAAkBmE,WAAnB,CAA3B;AACAvH,IAAAA,SAAS,CAACoD,MAAD,CAAT,CAAkBmE,WAAlB,GAA8B,IAA9B;AACL;AACN;;AAED,SAAS9E,YAAT,GAAwB;AAClB3C,EAAAA,aAAa,GAAG,IAAhB;;AAEA+I,EAAAA,gBAAgB;;AAErB;;AAED,SAASvB,iBAAT,CAA2BwB,GAA3B,EAA+BC,MAA/B,EAAsCrH,QAAtC,EAA+C;;AAEzC,MAAI6F,WAAW,GAAC1D,QAAQ,CAACmF,aAAT,CAAuB,OAAvB,CAAhB;AACAzB,EAAAA,WAAW,CAAC0B,QAAZ,GAAsB,IAAtB;;AAEA,MAAGF,MAAH,EAAU;AACJxB,IAAAA,WAAW,CAACN,SAAZ,GAAwB8B,MAAxB;AACL;;AAEDD,EAAAA,GAAG,CAACI,WAAJ,CAAgB3B,WAAhB;;AAEA,SAAO7F,QAAQ,CAAC,IAAD,EAAM6F,WAAN,CAAf;;AAEL;;AAED,SAASqB,2BAAT,CAAqCrB,WAArC,EAAiD;;AAE3C,MAAI4B,aAAa,GAAG5B,WAAW,CAAC4B,aAAhC;;AAEAA,EAAAA,aAAa,CAACC,WAAd,CAA0B7B,WAA1B;;AAEAA,EAAAA,WAAW,CAACN,SAAZ,GAAuB,IAAvB;;AAEL;;AAED,SAASN,gBAAT,GAA2B;;AAErB5C,EAAAA,QAAQ,CAACU,KAAT,CAAeC,OAAf,GAAwB,MAAxB;AACAR,EAAAA,QAAQ,CAACO,KAAT,CAAeC,OAAf,GAAyB,OAAzB;AACL;;;AAGD,SAASmE,gBAAT,GAA2B;;AAErB9E,EAAAA,QAAQ,CAACU,KAAT,CAAeC,OAAf,GAAwB,OAAxB;AACAR,EAAAA,QAAQ,CAACO,KAAT,CAAeC,OAAf,GAAyB,MAAzB;;AAEL","sourcesContent":["var connectedUser;\r\nvar room;\r\n\r\nvar peerConns={}; \r\nvar stream;\r\nvar signalingSocket;\r\nvar iceServers={};\r\n\r\nconst BROADCASTMESSAGE ={\r\n      ENTER_ROOM:\"broadcast:enterRoom\",\r\n      LEAVE_ROOM:\"broadcast:leaveRoom\"\r\n}\r\n  \r\nconst NEGOTIATION_MESSAGE ={\r\n      OFFER:\"negotiation:offer\",\r\n      ANSWER:\"negotiation:answer\",\r\n      CANDIDATE:\"negotiation:candidate\",\r\n      SUCESS_NEGOTIATION:\"negotiation:sucess\",\r\n      FAILED_NEGOTIATION:\"negotiation:failed\"\r\n}\r\n\r\nconst ROOM_MESSANGE ={\r\n      ENTER_ROOM:\"room:enterRoom\",\r\n      FAILED_ENTER_ROOM:\"room:failedEnterRoom\",\r\n      LEAVE_ROOM:\"room:leaveRoom\",\r\n}\r\n\r\nconst SESSION_MESSAGE ={\r\n      LOGIN: \"session:login\",\r\n      LOGOUT: \"session:logout\"\r\n}\r\n\r\nconst ERR_MESSAGE ={\r\n      INVALIDMESSAGE: \"err:invalidMessage\",\r\n      INVALIDUSER: \"err:invalidUser\",\r\n      SERVER_ERR:\"err:serverError\"\r\n}\r\n\r\nfunction SignalingSocket(){\r\n\r\n}\r\n\r\nSignalingSocket.prototype.init= function(wsURL,callback){\r\n      try{\r\n            this.websocket = new WebSocket(wsURL);\r\n      }catch(e){\r\n            console.log(e)\r\n      }\r\n\r\n      this.websocket.onopen = function () { \r\n            console.log(\"Connected to the signaling server\");\r\n            callback() \r\n      };\r\n            \r\n      \r\n      this.websocket.onmessage = function (msg) { \r\n            console.log(\"Got message\", msg.data);\r\n            \r\n            var data = JSON.parse(msg.data); \r\n            \r\n            switch(data.type) { \r\n            \r\n                  case SESSION_MESSAGE.LOGIN: \r\n                        handleLogin(data.success); \r\n                  break;\r\n\r\n                  case SESSION_MESSAGE.LOGOUT: \r\n                        handleLogout();  \r\n                  break;\r\n\r\n                  case \"authenticate\":\r\n                        handleAuthenticate(data.success);\r\n                  break;\r\n\r\n                  case ROOM_MESSANGE.ENTER_ROOM:\r\n                        handleEnterRoom();\r\n                  break;\r\n\r\n                  case ROOM_MESSANGE.LEAVE_ROOM:\r\n                        handleLeaveRoom();\r\n                  break;\r\n\r\n                  case NEGOTIATION_MESSAGE.OFFER: \r\n                        handleOffer( data.fromUserID,data.sdp); \r\n                  break;\r\n\r\n                  case NEGOTIATION_MESSAGE.ANSWER: \r\n                        handleAnswer(data.fromUserID,data.sdp); \r\n                  break; \r\n                  \r\n                  case NEGOTIATION_MESSAGE.CANDIDATE: \r\n                        handleCandidate(data.fromUserID,data.candidate); \r\n                  break; \r\n                  \r\n                  case BROADCASTMESSAGE.LEAVE_ROOM:\r\n                        handleBroadcastLeaveRoom(data.userID);\r\n                  break;\r\n                              \r\n                  default:\r\n\r\n                  break; \r\n            }\r\n      };\r\n            \r\n      this.websocket.onerror = function (err) { \r\n            console.log(\"Got error\", err); \r\n      };  \r\n     \r\n}\r\n\r\nSignalingSocket.prototype.send = function (message) { \r\n      if (connectedUser.name) { \r\n            message.fromUserID = connectedUser.name; \r\n      } \r\n      \r\n      console.log(\"send Message\" +JSON.stringify(message))\r\n\r\n      try{\r\n            this.websocket.send(JSON.stringify(message)); \r\n      }catch(exception){\r\n      \r\n            console.log(\"failed webscoket send\\ndetail:\",exception)\r\n      \r\n      }\r\n    \r\n};\r\n \r\nvar userIDInput = document.querySelector('#userIDInput'); \r\n\r\nvar roomPage = document.querySelector('#RoomPage'); \r\nvar roomIDInput = document.querySelector('#roomIDInput'); \r\nvar enterRoomBtn = document.querySelector('#enterRoomBtn'); \r\n\r\nvar callPage = document.querySelector('#callPage'); \r\nvar inviteoUserIDInput = document.querySelector('#inviteUserIDInput');\r\nvar inviteBtn = document.querySelector('#inviteBtn'); \r\nvar displayRoomID =document.querySelector(\"#displayRoomID\");\r\n\r\nvar leaveRoomBtn = document.querySelector('#leaveRoomBtn');\r\n\r\nvar videoArea = document.querySelector('#videoArea');\r\nvar localVideo = document.querySelector('#localVideo'); \r\n\r\n\r\ncallPage.style.display = \"none\";\r\n\r\nfunction getChannelinfo(userID,roomID,callback) {\r\n      var httpRequest = new XMLHttpRequest();\r\n  \r\n      if(!httpRequest) {\r\n            console.log('XMLHttpRequest not working')\r\n            callback(new Error('XMLHttpRequest not working'))\r\n      }\r\n\r\n      var url\r\n\r\n      if(window.location.protocol =='https:'){\r\n            url= 'https://rtc-session.smoothy-dev.com/room/'+roomID+'/user/'+userID //+'/nationcode/kor' \r\n      }else{\r\n            url= 'http://127.0.0.1:8080/room/'+roomID+'/user/'+userID //+ '/nationcode/kor'\r\n      }\r\n\r\n      httpRequest.open('GET',url ,true);\r\n\r\n      httpRequest.onreadystatechange = function() {\r\n            if (httpRequest.readyState === XMLHttpRequest.DONE) {\r\n                  if (httpRequest.status === 200) {\r\n\r\n                        var response = httpRequest.responseText\r\n                        console.log(response)\r\n\r\n                        callback(null, parsingResponseData(response))\r\n\r\n                  } else {\r\n\r\n                        console.log('http response err');\r\n                        callback(new Error('http response err'))\r\n\r\n                  }\r\n            }\r\n      }\r\n\r\n      function parsingResponseData(responseText){\r\n\r\n            return JSON.parse(responseText)\r\n      }\r\n\r\n      httpRequest.send(null);\r\n\r\n}\r\n  \r\n\r\nenterRoomBtn.addEventListener(\"click\",function(){\r\n    \r\n      connectedUser={\r\n            name: userIDInput.value\r\n      };\r\n\r\n      var roomID = roomIDInput.value;\r\n\r\n      room = {roomID:roomID};\r\n\r\n      displayRoomID.innerHTML =roomID;\t\r\n\r\n      getChannelinfo(userIDInput.value,roomIDInput.value,function(err,channelInfo){\r\n\r\n            if(err){\r\n                  console.log(err.toString())\r\n                  \r\n            }else{\r\n                  if(channelInfo.room.users){\r\n                        \r\n                        room.users =channelInfo.room.users\r\n\r\n                  }else{\r\n                        room.users =[]\r\n                  }\r\n\r\n                  if(channelInfo.serverinfo.stunServer){\r\n                        iceServers.stunServer =channelInfo.serverinfo.stunServer\r\n                  }\r\n\r\n                  if(channelInfo.serverinfo.turnServer){\r\n                        iceServers.turnServer =channelInfo.serverinfo.turnServer\r\n                  }\r\n                  \r\n                  signalingSocket = new SignalingSocket() \r\n                  \r\n                  signalingSocket.init(channelInfo.serverinfo.signalServer.url,function(){\r\n                        if (connectedUser.name.length > 0) { \r\n                              signalingSocket.send({ \r\n                                    type: SESSION_MESSAGE.LOGIN, \r\n                              }); \r\n                        }\r\n                  })\r\n            \r\n            \r\n\r\n            }\r\n\r\n      })\r\n      \r\n});\r\n\r\n\r\ninviteBtn.addEventListener(\"click\", function () { \r\n      var inviteUserID = inviteUserIDInput.value;\r\n            \r\n      if (inviteUserID.length > 0) { \r\n\r\n            signalingSocket.send({ \r\n                  type: \"invite\", \r\n                  toUserID: inviteUserID,\r\n                  roomID: room.roomID\r\n            });\r\n      }\r\n});\r\n\r\nleaveRoomBtn.addEventListener(\"click\", function () { \r\n\r\n      signalingSocket.send({ \r\n         type: ROOM_MESSANGE.LEAVE_ROOM, \r\n         roomID: room.roomID\r\n      });  \r\n         \r\n});\r\n  \r\nfunction handleLogin(success) { \r\n      if (success === false) { \r\n\r\n            connectedUser =null;\r\n            alert(\"Ooops...try a different userID\"); \r\n\r\n      } else { \r\n\r\n            if (room.roomID.length > 0) {       \r\n                  signalingSocket.send({\r\n                        type: ROOM_MESSANGE.ENTER_ROOM,\r\n                        roomID: room.roomID\r\n                  });\r\n            }\r\n      } \r\n};\r\n\r\nfunction handleAuthenticate(success){\r\n\r\n      if(!success){\r\n            alert(\"ooops.....user is not valid \");\r\n      }\r\n\r\n}\r\n\r\nfunction handleEnterRoom(){\r\n      var users =room.users\r\n\r\n      switchToCallpage()\r\n\r\n      if(users.length<=0){\r\n\r\n            navigator.webkitGetUserMedia({ video: true, audio: true }, function (myStream) { \r\n                  stream = myStream;      \r\n                  localVideo.srcObject = stream;\r\n                              \r\n            }, function (error) { \r\n                  console.log(error); \r\n            \r\n            });\r\n\r\n      }else{\r\n\r\n            navigator.webkitGetUserMedia({ video: true, audio: true }, function (myStream) { \r\n                  stream = myStream; \r\n                        \r\n                  localVideo.srcObject = stream;\r\n                  users.forEach((user,i)=>{\r\n\r\n                        var userID = user\r\n                        \r\n                        createRemoteVideo(videoArea,null,(err,remoteVideo)=>{\r\n                              if(err){\r\n                              console.log(err)\r\n                              }\r\n                              \r\n                              if(remoteVideo){\r\n                                    \r\n                                    initRtcPeerClient(iceServers,userID,remoteVideo,(err,client)=>{\r\n\r\n                                          peerConns[userID]=client\r\n\r\n                                          var conn = client.peerConnection\r\n                                          \r\n                                          conn.createOffer(function (offer) { \r\n                                          \r\n                                                signalingSocket.send({ \r\n                                                      type: NEGOTIATION_MESSAGE.OFFER, \r\n                                                      sdp: offer,\r\n                                                      toUserID:userID\r\n                                                }); \r\n\r\n                                                conn.setLocalDescription(offer); \r\n\r\n                                          }, function (error) { \r\n                                                alert(\"Error when creating an offer\"); \r\n                                          });\r\n                        \r\n                                    })\r\n\r\n                              }else{\r\n                              console.log(\"videoTemplete not available\")\r\n                              }\r\n\r\n                        })\r\n\r\n                  })\r\n  \r\n                 \r\n            }, function (error) { \r\n\r\n                  console.log(error);\r\n                  \r\n            });\r\n            \r\n      }\r\n}\r\n\r\nfunction handleOffer(userID,offer) { \r\n\r\n      createRemoteVideo(videoArea,null,(err,remoteVideo)=>{\r\n            if(err){\r\n                  console.log(err)\r\n            }\r\n            \r\n            if(remoteVideo){\r\n\r\n                  initRtcPeerClient(iceServers,userID,remoteVideo,(err,client)=>{\r\n\r\n                        peerConns[userID]=client\r\n\r\n                        var conn =client.peerConnection\r\n                        \r\n                        conn.setRemoteDescription(new RTCSessionDescription(offer));\r\n            \r\n                        conn.createAnswer(function (answer) { \r\n                              conn.setLocalDescription(answer); \r\n                                    \r\n                              signalingSocket.send({ \r\n                              type: NEGOTIATION_MESSAGE.ANSWER, \r\n                              sdp: answer,\r\n                              toUserID: userID\r\n                              });\r\n                              \r\n                        }, function (error) { \r\n                              alert(\"Error when creating an answer\"); \r\n                        }); \r\n\r\n                  })\r\n\r\n            }else{\r\n                  console.log(\"videoTemplete not available\")\r\n            }\r\n\r\n      })\r\n      \r\n};\r\n  \r\nfunction handleAnswer(userID,answer) { \r\n      peerConns[userID].peerConnection.setRemoteDescription(new RTCSessionDescription(answer)); \r\n};\r\n  \r\nfunction handleCandidate(userID,candidate) { \r\n      peerConns[userID].peerConnection.addIceCandidate(new RTCIceCandidate(candidate)); \r\n};\r\n\r\nfunction handleLeaveRoom(){\r\n\r\n      room = null;\r\n      \r\n      stream.getTracks().forEach((track,i)=>{\r\n            track.stop();\r\n      })\r\n      \r\n      for( userID in peerConns){\r\n\r\n            peerConns[userID].peerConnection.close(); \r\n            peerConns[userID].peerConnection.onicecandidate = null; \r\n            peerConns[userID].peerConnection.onaddstream = null;\r\n\r\n            peerConns[userID].remoteVideo.pause();\r\n            deleteRemoteleteRemoteVideo(peerConns[userID].remoteVideo)\r\n            peerConns[userID].remoteVideo=null\r\n\r\n      }\r\n\r\n      signalingSocket.send(\r\n            {\r\n                  type:SESSION_MESSAGE.LOGOUT\r\n            }\r\n      )\r\n      \r\n\r\n}\r\n\r\nfunction handleBroadcastLeaveRoom(userID){\r\n\r\n      console.log(userID +\" gone\")\r\n\r\n      if(peerConns[userID]){\r\n\r\n            peerConns[userID].peerConnection.close();\r\n            peerConns[userID].peerConnection.onicecandidate = null; \r\n            peerConns[userID].peerConnection.onaddstream = null;\r\n\r\n            peerConns[userID].remoteVideo.pause()\r\n            deleteRemoteleteRemoteVideo(peerConns[userID].remoteVideo)\r\n            peerConns[userID].remoteVideo=null\r\n      }\r\n}\r\n  \r\nfunction handleLogout() { \r\n      connectedUser = null; \r\n\r\n      switchToRoomPage()\r\n      \r\n};\r\n\r\nfunction createRemoteVideo(dom,source,callback){\r\n\r\n      var remoteVideo=document.createElement('video');\r\n      remoteVideo.autoplay =true;\r\n\r\n      if(source){\r\n            remoteVideo.srcObject = source\r\n      }\r\n\r\n      dom.appendChild(remoteVideo)\r\n\r\n      return callback(null,remoteVideo);\r\n\r\n}\r\n\r\nfunction deleteRemoteleteRemoteVideo(remoteVideo){\r\n\r\n      var parentElement = remoteVideo.parentElement\r\n\r\n      parentElement.removeChild(remoteVideo)\r\n\r\n      remoteVideo.srcObject =null;\r\n\r\n}\r\n\r\nfunction switchToCallpage(){\r\n\r\n      roomPage.style.display =\"none\";\r\n      callPage.style.display = \"block\";\r\n}\r\n\r\n\r\nfunction switchToRoomPage(){\r\n\r\n      roomPage.style.display =\"block\";\r\n      callPage.style.display = \"none\";\r\n\r\n}"],"file":"client.js"}